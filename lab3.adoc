= Отчет по теме: "Работа с прерываниями в микроконтроллерах"
:author: Нигматзянов К.М.
:group: ЕТ-211

== 1. Принцип работы прерываний

=== Что такое прерывания
Прерывание - это механизм, позволяющий процессору временно приостановить выполнение основной программы для обработки специального события.

=== Типы прерываний
* **Аппаратные** - возникают от внешних устройств (таймеры, UART, GPIO)
* **Программные** - инициируются программно (инструкции SWI, INT)
* **Исключения** - особые случаи (деление на ноль, ошибки памяти)

=== Процесс обработки прерывания
1. Возникновение события прерывания
2. Завершение текущей инструкции
3. Сохранение контекста (регистров)
4. Переход к обработчику прерывания
5. Выполнение обработчика
6. Восстановление контекста
7. Возврат к основной программе

== 2. Контроллер прерываний NVIC

=== Основные функции NVIC
Nested Vectored Interrupt Controller(NVIC) - это:
* Управление приоритетами прерываний
* Возможность вложенных прерываний
* Автоматическое определение вектора прерывания
* Быстрое переключение контекста

=== Ключевые особенности
* Поддержка до 240 внешних прерываний
* 256 уровней приоритета
* Низкая латентность переключения

== 3. Таблица векторов прерываний

=== Структура таблицы
* Располагается в начале памяти
* Содержит адреса обработчиков прерываний
* Каждому прерыванию соответствует свой вектор

=== Организация в Cortex-M
* Первые 16 векторов - системные исключения
* Остальные - внешние прерывания
* Адрес таблицы определяется регистром VTOR

== 4. Обработчики прерываний

=== Требования к обработчику
1. Минимальное время выполнения
2. Не должны блокироваться
3. Желательно использовать флаги вместо длительной обработки

=== Правильная реализация
[source,c]
----
void TIM2_IRQHandler(void) {
    if (TIM_GetITStatus(TIM2, TIM_IT_Update)) {
        // Обработка события
        TIM_ClearITPendingBit(TIM2, TIM_IT_Update);
    }
}
----

== 5. Обработка прерывания по переполнению таймера 2

=== Настройка таймера
1. Включение тактирования TIM2
2. Настройка предделителя и периода
3. Разрешение прерывания переполнения
4. Установка приоритета в NVIC
5. Включение таймера

=== Последовательность обработки
1. Таймер достигает значения переполнения
2. Генерируется прерывание
3. Процессор переходит к TIM2_IRQHandler
4. Проверяется флаг прерывания
5. Выполняется обработка события
6. Сбрасывается флаг прерывания
7. Процессор возвращается к основной программе

=== Пример кода
[source,c]
----
// Инициализация
RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2, ENABLE);
TIM_TimeBaseInitTypeDef timer;
timer.TIM_Prescaler = 16000-1;
timer.TIM_Period = 1000-1;
TIM_TimeBaseInit(TIM2, &timer);
TIM_ITConfig(TIM2, TIM_IT_Update, ENABLE);
NVIC_EnableIRQ(TIM2_IRQn);
TIM_Cmd(TIM2, ENABLE);

// Обработчик
void TIM2_IRQHandler(void) {
    if (TIM_GetITStatus(TIM2, TIM_IT_Update)) {
        // Действия при переполнении
        TIM_ClearITPendingBit(TIM2, TIM_IT_Update);
    }
}
----

== Выводы

1. Прерывания - мощный механизм реагирования на события в реальном времени
2. NVIC обеспечивает гибкое управление прерываниями в ARM-процессорах
3. Правильная обработка прерываний требует соблюдения временных ограничений
4. Таблица векторов - ключевой элемент системы прерываний
5. Работа с таймерными прерываниями демонстрирует практическое применение механизма прерываний