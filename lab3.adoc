== Принцип работы прерываний
*Прерывания* — это механизм, позволяющий микроконтроллеру оперативно реагировать на внешние или внутренние события, временно приостанавливая выполнение основной программы.

Как это работает:

1.При возникновении события (внешнего сигнала, таймера и т.д.) активируется прерывание

2.Процессор завершает текущую инструкцию

3.Сохраняет контекст (регистры, указатель инструкции) в стек

4.Переходит к выполнению обработчика прерывания (ISR)

5.После завершения ISR восстанавливает контекст и продолжает основную программу

*Типы прерываний*:

1.Аппаратные (от периферии: таймеры, UART, GPIO)

2.Программные (инициируются программно)

Исключения (ошибки выполнения, например, деление на ноль)







== Контроллер прерываний NVIC
*Nested Vectored Interrupt Controller* (NVIC) — это подсистема процессора, управляющая приоритетами и обработкой прерываний.

Основные функции NVIC:

1.Управление приоритетами прерываний

2.Возможность маскирования (отключения) прерываний

3.Поддержка вложенных прерываний

4.Автоматическое определение вектора прерывания

5.Управление состоянием прерываний (активно/ожидание)

NVIC позволяет эффективно обрабатывать множество прерываний с разными приоритетами, минимизируя задержки реакции на критические события.





== Таблица векторов прерываний
*Таблица векторов прерываний* — это массив указателей на функции-обработчики прерываний, расположенный в начале памяти микроконтроллера.

Особенности:

1.Каждому прерыванию соответствует определенная позиция в таблице

2.Содержит адреса обработчиков всех возможных прерываний

3.Обычно размещается по фиксированному адресу (часто 0x00000000)

4.Может быть переопределена в некоторых архитектурах

При возникновении прерывания процессор использует номер прерывания как индекс в этой таблице для получения адреса соответствующего обработчика.





== Обработчик прерываний (ISR)
*Обработчик прерывания* (Interrupt Service Routine, ISR) — это функция, которая выполняется при возникновении прерывания.

Правила написания обработчиков:

1.Должны быть максимально короткими и быстрыми

2.Не должны вызывать блокирующие или медленные функции

3.Должны очищать флаг прерывания (если не очищается автоматически)

4.Желательно использовать volatile переменные для обмена данными с основной программой

5.Не должны вызывать сложные операции (например, динамическое выделение памяти)





==  Обработка события переполнения таймера 2 через прерывание. Как это происходит?

*TIM2* — 32-битный таймер общего назначения, который может генерировать прерывание при переполнении, когда счетчик достигает заданного значения в регистре ARR и обнуляется.

*Шаги настройки таймера TIM2:*

1. Подключите тактирование модуля TIM2:
   RCC->APB1ENR |= RCC_APB1ENR_TIM2EN
2. Установите делитель (PSC) и значение автоперезагрузки (ARR), чтобы задать интервал.
3. Включите прерывание по переполнению:
   TIM2->DIER |= TIM_DIER_UIE
4. Очистите флаг переполнения:
   TIM2->SR &= ~TIM_SR_UIF
5. Включите таймер:
   TIM2->CR1 |= TIM_CR1_CEN
6. Разрешите прерывание в NVIC:
   NVIC_EnableIRQ(TIM2_IRQn)

*Когда таймер переполняется:*

- Счетчик обнуляется.
- Устанавливается флаг переполнения (UIF).
- Генерируется прерывание.
- NVIC вызывает обработчик прерывания TIM2_IRQHandler, который выполнит необходимые действия.